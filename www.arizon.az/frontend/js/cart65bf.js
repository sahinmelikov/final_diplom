const add_to_cart_form=$('.add-to-cart');const mini_cart=$('#mini-cart-list');const mini_cart_temp=$('#product-temp-for-cart').html();const product_all=$('.product-all');function init(){let h=-28,area=$(".products-menu.choose-submenu2");$('.for-fixed').each(function(i,e){h=h+$('.for-fixed').eq(i).height();});area.hide().css({'top':h});$('#select-all').click();get_cart();if($(".cart-item-update input[name=quantity]").val()<=1){$(".cart-item-update .dec").attr("disabled",true);}}
function get_cart(){let url=mini_cart.data('url'),token=mini_cart.data('token');$.post(url,{'_token':token},function(response){if(response.status==='success'){let html='',product_count=0;$.each(response.products,function(i,record){html=html+mini_cart_temp.replace(/::photo::/g,record.photo).replace(/::price::/g,record.price).replace(/::qty::/g,record.quantity).replace(/::product_id::/g,i).replace(/::name::/g,record.name);product_count=product_count+parseInt(record.quantity);});mini_cart.find('#product-list').html(html);$('#product-list-mobil').html(html);$('span.product-count').html(product_count);}});}
function add_to_cart(element,callback){element.unbind('submit').submit(function(){var form_this=$(this);form_this.ajaxSubmit({success:callback});return false;});}
$(function(){add_to_cart(add_to_cart_form,function(response){if(response.status==='success'){get_cart();$(".products-menu.choose-submenu2").hide().slideDown('slow');toastr.success('Səbətə əlavə olundu!','',{"positionClass":"toast-center-center","showDuration":"300","hideDuration":"1000","timeOut":"5000","extendedTimeOut":"1000","showEasing":"swing","hideEasing":"linear","showMethod":"fadeIn","hideMethod":"fadeOut"});$('.mobile-cart-show').trigger('click');}});$('button.buynow').click(function(){var url_=$(this).attr('data-url');add_to_cart(add_to_cart_form,function(response){if(response.status==='success'){window.location.href=url_+'?buynow='+(Math.random()+1).toString(36).substring(7);}});$(this).parents('.slider-detail-text').find('form.add-to-cart').submit();});$(".submenu>.basket, .submenu>.basket_text, .products-menu .close").click(function(){let area=$(".products-menu.choose-submenu2");if(area.css('display')=='none'){let h=-28;$('.for-fixed').each(function(i,e){h=h+$('.for-fixed').eq(i).height();});area.css({'top':h});area.slideDown('slow');}else{area.hide();}});function selected_items(){let count=$('.form-check-input.item:checked').length|0;$('span.selected-product-count').html(count);}
function cart_processes(type,callback){$('form.cart-processes').unbind('submit').submit(function(){var form_this=$(this),ids=[],items=$('.form-check-input.item:checked');items.each(function(i,v){ids.push(parseInt(items.eq(i).val()));});form_this.ajaxSubmit({beforeSubmit:function(arr,$form,options){arr.push({name:'selected_ids',value:ids});arr.push({name:'type',value:type});},success:callback});return false;});}
function total_price(){cart_processes('total_price',function(response){if(response.status==='success'){$('form.cart-processes button.cart-next-btn').html(response.total_price);}});$('form.cart-processes').submit();}
$(".trash_").click(function(){let x=$(this).find(".trash-menu");if($(this).find(".trash-menu").css('display')=='block'){$(this).find(".trash-menu").fadeOut();}else{$(this).find(".trash-menu").fadeIn();}
total_price();});$('#select-all').unbind('click').click(function(){let items=$('.form-check-input.item');var parent=$(this);items.each(function(){if(parent.is(':checked')){if(!$(this).is(':checked')){$(this).prop("checked",true);}}else{if($(this).is(':checked')){$(this).prop("checked",false);}}});selected_items();total_price();});$('.form-check-input.item').unbind('click').click(function(){if(!$(this).is(':checked')&&$('#select-all').is(':checked')){$('#select-all').removeAttr('checked');}
selected_items();total_price();});$('form.cart-item-delete').submit(function(){var form_this=$(this);form_this.ajaxSubmit({success:function(response){if(response.status==='success'){form_this.parents('div.product').remove();get_cart();total_price();}}});return false;});$('form.cart-selected-item-delete').submit(function(){var form_this=$(this);form_this.ajaxSubmit({beforeSubmit:function(arr,$form,options){let ids=[],items=$('.form-check-input.item:checked');items.each(function(i,v){ids.push(items.eq(i).val());});arr.push({name:'selected_ids',value:ids});},success:function(response){if(response.status==='success'){response.ids.forEach(function(i){$(".product-all .form-check-input.item[value="+i+"]").parents('div.product').remove();});selected_items();total_price();get_cart();}}});return false;});$('form.cart-item-update').submit(function(){var form_this=$(this);form_this.ajaxSubmit({success:function(response){if(response.status==='success'){get_cart();total_price();}}});return false;});$('button.cart-next-btn').click(function(){cart_processes('check_login',function(response){if(response.status==='success'){jQuery('#address').modal('show');}else if(response.status==='redirect'){window.location.href=response.url;}else{if(response.code==='ITEM404'){jQuery('#warning').modal('show');}else if(response.code==='UNAUTORIZED'){jQuery('#giris').modal('show');}}});$('form.cart-processes').submit();});init();});